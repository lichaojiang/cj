(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-3887"],{"0Thr":function(t,e,a){},KPom:function(t,e,a){"use strict";a.r(e);var n=a("gDS+"),r=a.n(n),o=a("U7nq"),i={name:"OrganizationAdmin",data:function(){return{userData:[],roleData:[],totalData:0,currentPage:1,pageSize:20,formOption:{title:"",showDeleteBtn:!1},query:{privilege:[]},addTaskDialogVisible:!1,formData:{name:"",user_id:[],privilege:[],note:""},formDataModel:{user_id:[],name:"",privilege:[],note:""},loginRules:{name:[{required:!0,trigger:"blur",message:"请输入分组名称！"}]},privilegeList:{admin:"管理员",analysis:"数据分析",production:"生产管理",user:"用户管理",monitor:"实时监控"}}},computed:{userTransData:function(){return this.userData.map(function(t){var e={};return e.key=t.id,e.label=t.name,e})},showRoleData:function(){var t=this,e=JSON.parse(r()(this.roleData)),a=function(a){var n=function(n){var r=t.userData.find(function(t){return t.id===e[a].user_id[n]});e[a].user_id[n]=void 0===r?"":r.name+" "};for(var r in e[a].user_id)n(r)};for(var n in e)a(n);return e}},beforeMount:function(){this.getUserInfo(),this.getRole()},methods:{getUserInfo:function(){var t=this;Object(o.i)({method:"read",query:{page:1,limit:999}}).then(function(e){t.userData=e.data.data.results}).catch(function(e){t.$message({message:"数据加载失败！"+e,type:"error"})})},getRole:function(){var t=this;Object(o.g)({method:"read",query:{page:t.currentPage,limit:t.pageSize,order:["id","ASC"]}}).then(function(e){t.roleData=e.data.data.results,t.totalData=e.data.data.total}).catch(function(e){t.$message({message:"数据加载失败！"+e,type:"error"})})},addTaskDialogConfirm:function(){var t=this,e=JSON.parse(r()(t.formData));e.privilege=e.privilege.toString();var a="create";t.formOption.showDeleteBtn&&(a="update"),Object(o.g)({method:a,query:e}).then(function(){t.$message({message:"create"===a?"新增分组成功！":"分组信息更新成功！",type:"success"}),t.getRole(),t.addTaskDialogVisible=!1}).catch(function(e){console.log(e),t.$message({message:"create"===a?"新增失败！"+e:"更新失败！"+e,type:"error"})})},addNewUser:function(){this.formData=this.formDataModel,this.addTaskDialogVisible=!0,this.formOption.showDeleteBtn=!1,this.formOption.title="新增分组"},formDeleteBtn:function(){var t=this;t.$confirm("确定删除？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){return Object(o.g)({method:"delete",query:{id:t.formData.id}}).then(function(){t.$message({message:"删除成功！",type:"success"}),t.getRole(),t.addTaskDialogVisible=!1})}).catch(function(e){t.$message({message:"删除失败！"+e,type:"error"})})},selectBtnClick:function(){this.getUserInfo()},cellEditClick:function(t){console.log(this.roleData);var e=JSON.parse(r()(this.roleData.find(function(e){return e.id===t.row.id})));e.privilege=e.privilege?e.privilege.split(","):[],this.formData=e,console.log(this.formData),this.addTaskDialogVisible=!0,this.formOption.showDeleteBtn=!0,this.formOption.title="编辑分组权限"},handleSizeChange:function(t){this.pageSize=t,this.getUserInfo()},handleCurrentChange:function(t){this.currentPage=t,this.getUserInfo()}}},l=(a("aYVH"),a("KHd+")),s=Object(l.a)(i,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"organizationAdmin"}},[a("el-dialog",{attrs:{visible:t.addTaskDialogVisible,title:t.formOption.title,width:"35%"},on:{"update:visible":function(e){t.addTaskDialogVisible=e}}},[a("el-form",{ref:"form",attrs:{model:t.formData,rules:t.loginRules,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"名称：",prop:"name"}},[a("el-input",{model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"描述：",prop:"note"}},[a("el-input",{model:{value:t.formData.note,callback:function(e){t.$set(t.formData,"note",e)},expression:"formData.note"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"权限：",prop:"privilege"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择权限",multiple:""},model:{value:t.formData.privilege,callback:function(e){t.$set(t.formData,"privilege",e)},expression:"formData.privilege"}},t._l(t.privilegeList,function(t,e){return a("el-option",{key:e,attrs:{label:t,value:e}})}))],1),t._v(" "),a("el-form-item",{attrs:{label:"组内用户：",prop:"user"}},[a("el-transfer",{attrs:{data:t.userTransData,titles:["组外用户","组内用户"]},model:{value:t.formData.user_id,callback:function(e){t.$set(t.formData,"user_id",e)},expression:"formData.user_id"}})],1)],1),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:t.formOption.showDeleteBtn,expression:"formOption.showDeleteBtn"}],attrs:{type:"danger"},on:{click:t.formDeleteBtn}},[t._v("删除")]),t._v(" "),a("el-button",{on:{click:function(e){t.addTaskDialogVisible=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{disabled:!t.formData.name,type:"primary"},on:{click:function(e){t.addTaskDialogConfirm()}}},[t._v("确 定")])],1)],1),a("el-container",[a("el-header",[a("el-row",{staticStyle:{margin:"22px"}},[a("el-col",{attrs:{offset:20,span:4}},[a("div",{staticClass:"grid-content"},[a("el-button",{on:{click:t.addNewUser}},[t._v("新增分组")])],1)])],1)],1),t._v(" "),a("el-main",[a("el-table",{attrs:{data:t.showRoleData,border:""}},[a("el-table-column",{attrs:{prop:"id",label:"编号"}}),t._v(" "),a("el-table-column",{attrs:{prop:"name",label:"名称"}}),t._v(" "),a("el-table-column",{attrs:{prop:"note",label:"描述"}}),t._v(" "),a("el-table-column",{attrs:{prop:"privilege",label:"权限"}}),t._v(" "),a("el-table-column",{attrs:{prop:"user_id",label:"组内用户"}}),t._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){t.cellEditClick(e)}}},[t._v("编辑")])]}}])})],1)],1),t._v(" "),a("el-footer",[a("el-pagination",{attrs:{"page-sizes":[20,50,100,200],"page-size":t.pageSize,total:t.totalData,"current-page":t.currentPage,layout:"total, sizes, prev, pager, next, jumper"},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)],1)],1)},[],!1,null,"a8566a30",null);s.options.__file="organizationAdmin_m.vue";e.default=s.exports},U7nq:function(t,e,a){"use strict";a.d(e,"b",function(){return g}),a.d(e,"e",function(){return h}),a.d(e,"j",function(){return v}),a.d(e,"d",function(){return b}),a.d(e,"f",function(){return D}),a.d(e,"c",function(){return _}),a.d(e,"h",function(){return O}),a.d(e,"a",function(){return k}),a.d(e,"g",function(){return y}),a.d(e,"i",function(){return w});var n=a("t3Un"),r="/datatable",o="/analysis",i="/analysis/variable",l="/production/plan",s="/role",u="/user/list",c="http://www.bivrost.cn",d="/production/product",f="/production/group",m="/user",p="/chartdata";function g(t){return Object(n.a)({url:c+r,method:"get",params:t})}function h(t,e){return Object(n.a)({url:c+o,method:"post",data:e})}function v(t){return Object(n.a)({url:c+i,method:"post",data:t})}function b(t){return Object(n.a)({url:c+l,method:"post",data:t})}function D(t){return Object(n.a)({url:c+d,method:"post",data:t})}function _(t){return Object(n.a)({url:c+f,method:"post",data:t})}function O(t){return Object(n.a)({url:c+m,method:"post",data:t})}function k(t){return Object(n.a)({url:c+p,method:"post",data:t})}function y(t){return Object(n.a)({url:c+s,method:"post",data:t})}function w(t){return Object(n.a)({url:c+u,method:"post",data:t})}},aYVH:function(t,e,a){"use strict";var n=a("0Thr");a.n(n).a},"gDS+":function(t,e,a){t.exports={default:a("oh+g"),__esModule:!0}},"oh+g":function(t,e,a){var n=a("WEpk"),r=n.JSON||(n.JSON={stringify:JSON.stringify});t.exports=function(t){return r.stringify.apply(r,arguments)}}}]);